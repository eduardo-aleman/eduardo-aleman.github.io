<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Línea de Tiempo: Antigua Grecia con IA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 50%;
            width: 4px;
            height: 100%;
            background-color: #cbd5e1;
            transform: translateX(-50%);
            z-index: 0;
        }

        .timeline-item::after { /* Cambiado de .timeline-event a .timeline-item para generalizar */
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            border: 4px solid; /* El color se define por la clase del periodo */
            top: 2.25rem; 
            z-index: 1;
        }

        .timeline-item.left::after {
            right: -12px;
        }

        .timeline-item.right::after {
            left: -12px;
        }
        
        .period-header.left::after, .period-header.right::after {
             top: 1.5rem; /* Ajuste para cabeceras de periodo */
        }


        /* Clases de color para los periodos */
        .period-minoan { border-color: #38bdf8 !important; } /* sky-500 */
        .period-mycenaean { border-color: #60a5fa !important; } /* blue-400 */
        .period-dark-age { border-color: #94a3b8 !important; } /* slate-400 */
        .period-archaic { border-color: #facc15 !important; } /* yellow-400 */
        .period-classical { border-color: #4ade80 !important; } /* green-400 */
        .period-hellenistic { border-color: #a78bfa !important; } /* violet-400 */

        .timeline-item { /* Cambiado de .timeline-event a .timeline-item */
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .timeline-item.visible { /* Cambiado de .timeline-event a .timeline-item */
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .timeline-container::before {
                left: 20px;
            }
            .timeline-item.left, .timeline-item.right { /* Cambiado de .timeline-event a .timeline-item */
                width: 100%;
                left: 0;
                padding-left: 50px; 
                padding-right: 1rem;
                text-align: left !important;
            }
            .timeline-item.left::after, .timeline-item.right::after { /* Cambiado de .timeline-event a .timeline-item */
                left: 8px; 
            }
             .timeline-item.left .event-content, .timeline-item.right .event-content,
             .period-header-content { /* Aplicar también a period-header-content */
                border-left-width: 4px;
                border-right-width: 0;
            }
        }

        /* Estilos para el Modal */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            transition: color 0.2s;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #geminiResponseContainer {
            min-height: 50px; /* Para que el loader se vea bien */
            background-color: #f9fafb; /* gris muy claro */
            border: 1px solid #e5e7eb; /* gris claro */
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
            margin-bottom: 15px;
            white-space: pre-wrap; /* Para respetar saltos de línea y espacios */
            max-height: 300px;
            overflow-y: auto;
        }
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <header class="bg-slate-800 text-white py-8 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-bold text-center">Línea de Tiempo: Antigua Grecia con IA</h1>
        <p class="text-center text-slate-300 mt-2">Desde la Edad del Bronce hasta el Período Helenístico</p>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="relative timeline-container" id="timelineContainer">
            </div>
    </main>

    <div id="geminiModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" class="text-2xl font-bold text-slate-700 mb-3">Información Adicional</h2>
            <div id="geminiResponseContainer">
                </div>
            <div id="askMoreSection" class="mt-4 hidden">
                <textarea id="userQuestionInput" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="Escribe tu pregunta aquí..."></textarea>
                <button id="submitUserQuestionButton" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-150 flex items-center justify-center">
                    ✨ Preguntar a Gemini
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-slate-800 text-white text-center py-6 mt-12">
        <p>&copy; <span id="currentYear"></span> Línea de Tiempo Interactiva. Creada con HTML, Tailwind CSS y JavaScript. Funciones de IA por Gemini.</p>
    </footer>

    <script>
        // --- DATOS DE LA LÍNEA DE TIEMPO ---
        const timelineItemsData = [
            // Cabecera de Periodo
            { type: 'period-header', name: 'Edad del Bronce', dates: 'c. 3000 – c. 1100 a.C.', periodClass: 'minoan' }, // Usamos minoan como color genérico para la edad de bronce
            {
                type: 'event', date: "c. 3000 – 1450 a.C.", title: "Civilización Minoica",
                description: "Desarrollo en Creta. Palacios como Cnosos. Escritura Lineal A. Talasocracia (dominio marítimo). Famosos por sus frescos y cerámica.",
                period: "minoan"
            },
            {
                type: 'event', date: "c. 1600 – 1100 a.C.", title: "Civilización Micénica",
                description: "Grecia Continental. Centros fortificados como Micenas y Tirinto. Guerreros y comerciantes. Escritura Lineal B (griego temprano). Máscara de Agamenón.",
                period: "mycenaean"
            },
            {
                type: 'event', date: "c. 1250 – 1200 a.C.", title: "Guerra de Troya (Tradicional)",
                description: "Legendario conflicto entre aqueos (micénicos) y troyanos, narrado en la Ilíada de Homero. Simboliza el final de la era heroica.",
                period: "mycenaean"
            },
            // Cabecera de Periodo
            { type: 'period-header', name: 'Edad Oscura Griega', dates: 'c. 1100 – c. 800 a.C.', periodClass: 'dark-age' },
            {
                type: 'event', date: "c. 1100 – 800 a.C.", title: "Colapso y Transición",
                description: "Colapso de la civilización micénica. Decadencia demográfica y cultural, pérdida de la escritura. Migraciones griegas a Asia Menor. Desarrollo de la cerámica protogeométrica y geométrica. Formación de las primeras poleis (ciudades-estado).",
                period: "dark-age"
            },
            // Cabecera de Periodo
            { type: 'period-header', name: 'Período Arcaico', dates: 'c. 800 – c. 480 a.C.', periodClass: 'archaic' },
            {
                type: 'event', date: "776 a.C.", title: "Primeros Juegos Olímpicos",
                description: "Fecha tradicional del inicio de los Juegos Olímpicos en Olimpia, un evento panhelénico que fomentaba la unidad cultural griega.",
                period: "archaic"
            },
            {
                type: 'event', date: "c. 800 - 700 a.C.", title: "Adopción del Alfabeto",
                description: "Los griegos adaptan el alfabeto fenicio, añadiendo vocales. Esto facilita la escritura y la difusión del conocimiento. Composición oral de la Ilíada y la Odisea (Homero).",
                period: "archaic"
            },
            {
                type: 'event', date: "c. 750 – 550 a.C.", title: "Gran Colonización Griega",
                description: "Expansión de las poleis por el Mediterráneo y el Mar Negro (Magna Grecia, Sicilia, costas de Francia, España, norte de África). Fundación de nuevas ciudades.",
                period: "archaic"
            },
            {
                type: 'event', date: "594 a.C.", title: "Reformas de Solón en Atenas",
                description: "Legislador ateniense que introdujo reformas para aliviar la crisis social y económica, sentando bases para la democracia (e.g., abolición de la esclavitud por deudas).",
                period: "archaic"
            },
            {
                type: 'event', date: "508/507 a.C.", title: "Reformas de Clístenes",
                description: "Considerado el fundador de la democracia ateniense (demokratia). Reorganizó la ciudadanía y el consejo (Boulé).",
                period: "archaic"
            },
            {
                type: 'event', date: "499 – 494 a.C.", title: "Revuelta Jónica",
                description: "Ciudades griegas de Jonia (Asia Menor) se rebelan contra el dominio persa, con apoyo limitado de Atenas y Eretria. Fracasa pero desencadena las Guerras Médicas.",
                period: "archaic"
            },
            {
                type: 'event', date: "490 a.C.", title: "Primera Guerra Médica: Maratón",
                description: "Victoria ateniense decisiva sobre la expedición persa de Darío I en la Batalla de Maratón.",
                period: "archaic"
            },
            // Cabecera de Periodo
            { type: 'period-header', name: 'Período Clásico', dates: 'c. 480 – 323 a.C.', periodClass: 'classical' },
             {
                type: 'event', date: "480 – 479 a.C.", title: "Segunda Guerra Médica",
                description: "Invasión persa de Jerjes I. Batallas clave: Termópilas (derrota heroica espartana), Artemisio (naval), Salamina (victoria naval griega decisiva), Platea (victoria terrestre griega).",
                period: "classical"
            },
            {
                type: 'event', date: "478/477 a.C.", title: "Fundación de la Liga de Delos",
                description: "Alianza de ciudades-estado griegas, liderada por Atenas, para continuar la lucha contra Persia y liberar las ciudades jonias. Se transforma gradualmente en un imperio ateniense.",
                period: "classical"
            },
            {
                type: 'event', date: "c. 461 – 429 a.C.", title: "Siglo de Pericles en Atenas",
                description: "Apogeo de la democracia ateniense bajo el liderazgo de Pericles. Florecimiento de la filosofía (Sócrates), el teatro (Esquilo, Sófocles, Eurípides), la historia (Heródoto, Tucídides) y las artes (Partenón, Fidias).",
                period: "classical"
            },
            {
                type: 'event', date: "431 – 404 a.C.", title: "Guerra del Peloponeso",
                description: "Devastador conflicto entre Atenas y su imperio (Liga de Delos) contra Esparta y sus aliados (Liga del Peloponeso). Termina con la derrota de Atenas.",
                period: "classical"
            },
            {
                type: 'event', date: "399 a.C.", title: "Muerte de Sócrates",
                description: "El influyente filósofo ateniense es condenado a muerte por impiedad y corromper a la juventud. Su juicio y muerte son eventos cruciales en la historia del pensamiento.",
                period: "classical"
            },
            {
                type: 'event', date: "338 a.C.", title: "Batalla de Queronea",
                description: "Filipo II de Macedonia derrota a una coalición de ciudades-estado griegas (principalmente Atenas y Tebas), estableciendo la hegemonía macedonia sobre Grecia. Formación de la Liga de Corinto.",
                period: "classical"
            },
            {
                type: 'event', date: "336 a.C.", title: "Ascenso de Alejandro Magno",
                description: "Tras el asesinato de su padre Filipo II, Alejandro hereda el trono de Macedonia y los planes para invadir el Imperio Persa.",
                period: "classical"
            },
            // Cabecera de Periodo
            { type: 'period-header', name: 'Período Helenístico', dates: '323 – 31 a.C.', periodClass: 'hellenistic' },
            {
                type: 'event', date: "334 – 323 a.C.", title: "Conquistas de Alejandro Magno",
                description: "Alejandro lidera al ejército greco-macedonio en una serie de victorias que destruyen el Imperio Persa y extienden su propio imperio desde Grecia hasta la India, difundiendo la cultura griega (helenización).",
                period: "hellenistic"
            },
            {
                type: 'event', date: "323 a.C.", title: "Muerte de Alejandro Magno",
                description: "Alejandro muere en Babilonia sin un heredero claro. Su vasto imperio se fragmenta entre sus generales (los Diádocos), dando inicio al Período Helenístico y a décadas de guerras de sucesión.",
                period: "hellenistic"
            },
            {
                type: 'event', date: "323 – c. 281 a.C.", title: "Guerras de los Diádocos",
                description: "Los generales de Alejandro (Ptolomeo, Seleuco, Antígono, Lisímaco, etc.) luchan por el control de su imperio, resultando en la formación de los grandes reinos helenísticos: Ptolemaico (Egipto), Seléucida (Asia), Antigónida (Macedonia).",
                period: "hellenistic"
            }
        ];

        // --- LÓGICA DE LA LÍNEA DE TIEMPO Y GEMINI ---
        const modal = document.getElementById('geminiModal');
        const modalTitle = document.getElementById('modalTitle');
        const responseContainer = document.getElementById('geminiResponseContainer');
        const askMoreSection = document.getElementById('askMoreSection');
        const userQuestionInput = document.getElementById('userQuestionInput');
        const submitUserQuestionButton = document.getElementById('submitUserQuestionButton');
        let currentEventForModal = null; // Para guardar el contexto del evento actual para preguntas adicionales

        // Función para llamar a la API de Gemini
        async function callGemini(prompt) {
            responseContainer.innerHTML = '<div class="loader"></div> <p class="text-center text-slate-500">Consultando a Gemini...</p>';
            askMoreSection.classList.add('hidden'); // Ocultar sección de pregunta adicional mientras carga

            const apiKey = ""; // Dejar vacío, Canvas lo gestionará
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`Error de la API: ${response.status} ${response.statusText}. Cuerpo: ${errorBody}`);
                }
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    responseContainer.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`; // Reemplazar saltos de línea
                    return text; // Devolver el texto para posible uso posterior
                } else {
                    console.error("Respuesta inesperada de la API:", result);
                    responseContainer.textContent = "No se pudo obtener una respuesta válida de Gemini. Intenta de nuevo.";
                }
            } catch (error) {
                console.error("Error llamando a Gemini:", error);
                responseContainer.textContent = `Error al contactar a Gemini: ${error.message}. Por favor, revisa la consola para más detalles.`;
            }
            return null; // Devolver null si hubo un error
        }

        function openModal() {
            modal.style.display = "block";
        }

        function closeModal() {
            modal.style.display = "none";
            responseContainer.innerHTML = ""; // Limpiar contenido
            userQuestionInput.value = ""; // Limpiar input
            askMoreSection.classList.add('hidden');
            currentEventForModal = null;
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        function handleLearnMore(eventData) {
            currentEventForModal = eventData; // Guardar datos del evento
            modalTitle.textContent = `✨ Saber Más: ${eventData.title}`;
            openModal();
            const prompt = `Proporciona un dato interesante o un detalle adicional conciso (2-3 frases) sobre el evento de la Antigua Grecia: "${eventData.title} (${eventData.date}) - ${eventData.description}". Este dato es para una línea de tiempo visual.`;
            callGemini(prompt).then(() => {
                 askMoreSection.classList.remove('hidden'); // Mostrar sección para preguntar más después de la primera respuesta
            });
        }
        
        submitUserQuestionButton.onclick = function() {
            const userQuestion = userQuestionInput.value.trim();
            if (userQuestion && currentEventForModal) {
                modalTitle.textContent = `Respondiendo sobre: ${currentEventForModal.title}`;
                const prompt = `Con respecto al evento de la Antigua Grecia "${currentEventForModal.title} (${currentEventForModal.date})", responde la siguiente pregunta: "${userQuestion}". Proporciona una respuesta concisa e informativa.`;
                callGemini(prompt);
                userQuestionInput.value = ""; // Limpiar input después de enviar
            } else if (!userQuestion) {
                 responseContainer.innerHTML = "<p class='text-red-500'>Por favor, escribe una pregunta.</p>" + responseContainer.innerHTML;
            }
        };


        function handleSummarizePeriod(periodData) {
            modalTitle.textContent = `✨ Resumen del ${periodData.name}`;
            openModal();
            const prompt = `Proporciona un resumen conciso (alrededor de 100-150 palabras) del periodo "${periodData.name} (${periodData.dates})" en la historia de la Antigua Grecia. Destaca sus principales características, desarrollos clave y significado general. Este resumen es para una línea de tiempo visual.`;
            callGemini(prompt);
            // No mostramos la sección de "preguntar más" para resúmenes de periodo.
            askMoreSection.classList.add('hidden');
        }


        document.addEventListener('DOMContentLoaded', function() {
            const timelineContainer = document.getElementById('timelineContainer');
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            const periodColors = {
                minoan: 'border-sky-500', mycenaean: 'border-blue-400', 'dark-age': 'border-slate-400',
                archaic: 'border-yellow-400', classical: 'border-green-400', hellenistic: 'border-violet-400'
            };
            const periodTextColors = {
                minoan: 'text-sky-600', mycenaean: 'text-blue-500', 'dark-age': 'text-slate-600',
                archaic: 'text-yellow-600', classical: 'text-green-600', hellenistic: 'text-violet-600'
            };

            timelineItemsData.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('timeline-item', 'mb-8', 'relative'); // mb-8 para separación

                const side = index % 2 === 0 ? 'left' : 'right';
                itemElement.classList.add(side);
                
                // Aplicar color del período al punto y al borde de la tarjeta
                const itemPeriodClass = item.period || item.periodClass; // Usar periodClass para headers
                const borderColorClass = periodColors[itemPeriodClass] || 'border-gray-400';
                const textColorClass = periodTextColors[itemPeriodClass] || 'text-gray-700';
                itemElement.classList.add(`period-${itemPeriodClass}`); // Para el ::after

                if (item.type === 'period-header') {
                    itemElement.classList.add('w-full', 'md:w-3/4', 'mx-auto', 'period-header'); // Más ancho para cabeceras
                     if (side === 'left') {
                        itemElement.classList.add('md:mr-auto', 'md:ml-0'); // Alinea a la izquierda en desktop
                    } else {
                        itemElement.classList.add('md:ml-auto', 'md:mr-0'); // Alinea a la derecha en desktop
                    }
                    itemElement.innerHTML = `
                        <div class="period-header-content bg-white p-4 rounded-lg shadow-lg ${borderColorClass} ${side === 'left' ? 'border-r-4 md:border-r-0 md:border-l-4' : 'border-l-4'} text-center md:text-left">
                            <h2 class="text-2xl md:text-3xl font-bold ${textColorClass} mb-1">${item.name}</h2>
                            <p class="text-slate-500 text-sm md:text-base mb-3">${item.dates.replace(/–/g, '-')}</p>
                            <button class="summarize-period-btn bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md text-sm transition-colors duration-150">
                                ✨ Resumir este Periodo
                            </button>
                        </div>
                    `;
                    itemElement.querySelector('.summarize-period-btn').addEventListener('click', () => handleSummarizePeriod(item));

                } else { // Es un evento
                    itemElement.classList.add('w-full', 'md:w-1/2'); // Ancho normal para eventos
                    if (side === 'left') {
                        itemElement.classList.add('md:pr-8', 'text-left', 'md:text-right');
                    } else {
                        itemElement.classList.add('md:ml-auto', 'md:pl-8', 'text-left');
                    }
                    itemElement.innerHTML = `
                        <div class="event-content bg-white p-6 rounded-lg shadow-xl transition-all duration-300 hover:shadow-2xl ${borderColorClass} ${side === 'left' ? 'border-r-4 md:border-r-4' : 'border-l-4 md:border-l-4'}">
                            <p class="text-sm font-semibold ${textColorClass} mb-1">${item.date.replace(/–/g, '-')}</p>
                            <h2 class="text-xl md:text-2xl font-bold text-slate-700 mb-2">${item.title}</h2>
                            <p class="text-slate-600 text-sm md:text-base mb-3">${item.description}</p>
                            <button class="learn-more-btn bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-3 rounded-md text-sm transition-colors duration-150">
                                ✨ Saber Más
                            </button>
                        </div>
                    `;
                    itemElement.querySelector('.learn-more-btn').addEventListener('click', () => handleLearnMore(item));
                }
                timelineContainer.appendChild(itemElement);
            });

            const observerItems = document.querySelectorAll('.timeline-item');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            observerItems.forEach(obsItem => observer.observe(obsItem));
        });
    </script>
</body>
</html>
